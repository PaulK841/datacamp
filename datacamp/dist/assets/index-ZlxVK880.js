(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))e(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const m="a80cc994deaf48b6a7363687970d729b",f="http://localhost:5173/callback",p=new URLSearchParams(window.location.search).get("code");p?(async()=>{try{const t=await k(m,p),r=await w(t);I(r);const n=await E(t,"tracks");await b(t,n)}catch(t){console.error("Error during authentication process:",t),alert("Failed to authenticate: "+t.message)}})():_(m);async function w(t){const r=await fetch("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!r.ok){const n=await r.json();throw new Error(`Error fetching profile: ${n.error.message}`)}return await r.json()}async function E(t,r,n="long_term"){const e=await fetch(`https://api.spotify.com/v1/me/top/${r}?time_range=${n}&limit=50&offset=0`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!e.ok){const o=await e.json();throw new Error(`Error fetching top tracks: ${o.error.message}`)}return await e.json()}async function b(t,r){const n=document.getElementById("tracks-list"),e=[],o=["Name","Acousticness","Danceability","Duration (ms)","Energy","Instrumentalness","Key","Liveness","Loudness","Mode","Speechiness","Tempo","Time Signature","Valence"];e.push(o.join(","));for(const i of r.items){const l=await fetch(`https://api.spotify.com/v1/audio-features/${i.id}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(!l.ok){const y=await l.json();throw new Error(`Error fetching track features: ${y.error.message}`)}const a=await l.json();i.features=a;const u=document.createElement("li");u.textContent=`${i.name} - Danceability: ${a.danceability}, Energy: ${a.energy}, Tempo: ${a.tempo}`,n.appendChild(u);const g=[i.name,a.acousticness,a.danceability,a.duration_ms,a.energy,a.instrumentalness,a.key,a.liveness,a.loudness,a.mode,a.speechiness,a.tempo,a.time_signature,a.valence];e.push(g.join(","))}const s=e.join(`
`),c=new Blob([s],{type:"text/csv"}),h=URL.createObjectURL(c),d=document.createElement("a");d.setAttribute("href",h),d.setAttribute("download","top_tracks_features.csv"),d.click()}async function _(t){const r=v(128),n=await T(r);localStorage.setItem("verifier",r);const e=new URLSearchParams;e.append("client_id",t),e.append("response_type","code"),e.append("redirect_uri",f),e.append("scope","user-read-private user-read-email user-top-read"),e.append("code_challenge_method","S256"),e.append("code_challenge",n),document.location=`https://accounts.spotify.com/authorize?${e.toString()}`}function v(t){let r="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let e=0;e<t;e++)r+=n.charAt(Math.floor(Math.random()*n.length));return r}async function T(t){const r=new TextEncoder().encode(t),n=await window.crypto.subtle.digest("SHA-256",r);return btoa(String.fromCharCode(...new Uint8Array(n))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function k(t,r){const n=localStorage.getItem("verifier"),e=new URLSearchParams;e.append("client_id",t),e.append("grant_type","authorization_code"),e.append("code",r),e.append("redirect_uri",f),e.append("code_verifier",n);const o=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e});if(!o.ok){const c=await o.json();throw new Error(`Failed to fetch access token: ${c.error_description}`)}return(await o.json()).access_token}function I(t){var n,e;document.getElementById("displayName").textContent=t.display_name,document.getElementById("id").textContent=t.id,document.getElementById("email").textContent=t.email,document.getElementById("uri").textContent=t.uri,document.getElementById("uri").href=t.uri,document.getElementById("url").textContent=t.external_urls.spotify,document.getElementById("url").href=t.external_urls.spotify,document.getElementById("imgUrl").textContent=((n=t.images[0])==null?void 0:n.url)||"No image available";const r=document.getElementById("avatar");r.innerHTML=`<img src="${(e=t.images[0])==null?void 0:e.url}" alt="Profile Image" width="150">`}
